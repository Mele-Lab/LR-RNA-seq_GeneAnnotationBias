Location of random 4k reads
```bash
/gpfs/projects/bsc83/Projects/pantranscriptome/Pau/01_ONT_preprocessing/4kbam_entries.sam
```

Duplex-simplex triad
```bash
d65b3319-7e5b-4fb2-85b0-a0c53030758c;c37bf89a-f235-414f-919c-e2e2f5d81d89	4	*	0	0	*	*	0	0	CGTCAGATGTGGTATCAAACGCAAGAGTACGGCCGCCGCTTCCTCTCGAGAGGCGCGGGGCGGGCTGTCCGGCCCGCAGGGCGGTCGAGCCCGCGGCGCCATGGCTCACGTCGGCTCCCGCAAGCGCTCGAGGAGTCGCAGCCGGTCCCGGGGACGGGGGTCGGAAAGAAGAAGAAGAGCAGGAAAGACACCTCGAGGAACTGCTCGGCCTCCACATCCCAAGAGAGAAGCAAGCAGAAGGCCCGGAGGAGAACAAGATCCAGCTCCTCCTCCTCTTCTTCCAGTTCTTCTAGCTCCTCTTCTTCCTCCTCGTCCTCCTCCTCTTCCTCCAGTGATGGCCGGAAGAAGCGGGGGAAGTACAAGGACAAGAGGAGGAAGAAGAAGAAGAAGAGGAGCCAAGAAGAAGGGCAAGGAGAAGGCGGAAGCACAGCAGGTGGAGGCTCTGCCGGGCCCCGTCGCTGGACCAGTGGCACCGATCAGCTGGGGAGGAAGAGGATGGCCCAGTCCTGACGGATGAGCAGAAGTCCCGAATCCAGGCCATGAAGCCCACGACCAAGGAGGAGTGGGATGCCCGGCAGAGCATCATCCGCAAGGTGGTGGACCCTGAGACGGGGCGCACCAGGCTTATTAAGGGAGATGGCGAGGTCCTAGAGGAAATCGTAACCAAAGAACGACACAGAGAGATCAACAAGCCACCCGAGGGGACTGCCTGGCCTTCCAGATGCGAGCTGGGTTGCTTCCCTGAGGGCCCCCGCTGGCCAAGGCCTGTGGACGCGACACGTGGCGGCCCAGCCTTGGGCAGGTTTCAGGGTGCCAGTGGGAAGCCTGATGGGCTTGGGTGGCCTTTCCCCCGTGGA	%'''''''())*****)))*....///11137789899:543210/.-,+)()+,--42221110/./189:::788777335568768876574323447678899:9::<<8877650.--.---,---03556565788;:::65455855436:=9755211.12214201855<<?;8;>;==@??>=36666JSC?<9999:;@:9726888<70///298A@EB=9899:9A@BCSJGBDHSCEDSEEDFA@@D@==@?>=?DABLFSEDFDSBBIBE<9>88:5542/,-01/,/2/91@??=44;>AADBAB?@@A?:8;:777:;>=;==5978@BDJJEFSL>C>67>AEBCEBDSSIBDBBF;=79<?=<=43.-,-..*+)'&''()1?BCDEBBCSBFFFIDOSGDSDHHDSFEDDFSDEFDFBCAF@>>>=;532121/,+''167<FS?BDEIEBBCGSBCJDCDCB?BADEF>>DFGDDGBSBCSD@NBABA=<=>?74313>?BDD?<5,,,('(++/2BAAISCCDECBABSCES@C?M>?<:98:=;>A>?D14;78@=99::SC@CCDFSE@BBABA?B<H?;:;72278?DDGECCEDADDBCDDAAA**.5:=;;::99988;==:98:=>;>?>?BB???CLKFNHD@CHSSFDBSKSJECB/+++-11//.021956=8/.-23+*+45<;=DDFGSAC?@@?AA=<<?100098>??GDDDCDDESFESDLGC>=767EA@ABDD></(&'('(**''.19:;A>=>62+*,1.@ABAC@A?=BBBFFADKA@C<=DDDEESC?92/.,(&'(',/02343355035<::6	qs:i:18	dx:i:1	mx:i:1	ch:i:1	st:Z:2024-02-14T07:55:23.546+00:00	RG:Z:69fa17d18c78aff9642adc25f5aff63f55751857_dna_r10.4.1_e8.2_400bps_sup@v4.3.0_dna_r10.4.1_e8.2_5khz_stereo@v1.2
d65b3319-7e5b-4fb2-85b0-a0c53030758c	4	*	0	0	*	*	0	0	GTTTTGTAGTGTCTCGGTCTCGTTGCGTATTGCTCGTCGGCAGCGTCAGATGTGTATAGAGACAGTTGGTTACCCCGTTATGTGGTATAGAACGCGGGGACCGAGCCACCGCTTCCTCTCGAGAGAAGGCGCGGGGCGGGCTGTCCGGGCCCCACAGGGCCGTCGAGCCCGCAGGCGCCATGGCTCACGTCGGCTCCCGCAAGCGCTCGAGGAGTCGCAGCCATTACGGGGACGGGGGTCGGGGGAAAAAGAGAAAGAAGAAGAGCAGGAAAGACACCTCGAGGAACTGCTCGGCCTCCCACATCCCAAGAGAGAAGCAAGCAGAAGGCCCGGAGGAGAACAAGATCCAGCTCCTCCTCCTCTTCTTCCAGTTCTTCTAGCTCCTCTTCTTCCTCCTCGTCCTCCTCCTCTTCCTCCAGTGATGGCCGGAAGAAGCGGGGGAAGTACAAGGACAAGAGGAGGAAGAAGAAGAGGAAGAAGCTAAGAAGAAGGGCAAGGAGAAGGCGGAAGCACAGCAGGTGGAGGCTCTGCCGGGCCCCTCGCTGGACCAGTGGCACCGATCGGCTGGGGAGGAAGAGGATGGCCCAGTCCTGACGGATGAGCAGAAGTCCGATCCAGGCCATGAAGCCCACGACCAAGGAGAAGTGGGATAGGCGCAGCATCATCCGCAAGGTGGTGGAGCCTGAAGCGGGCGCACCAGGCTCCTAGGGAAATAGCGGTCCTAGAGGAAATCGTAACCAAAGAACGACACAGAGAGATCAACAAGCAAGCCACCGAGGAACTCCTGGCCTTCCAGATGCAAGCTGGGTTTACTCCCCTGAGGGCCCCCGCTGGCCAGGCCTGTGGACAAACACTGGCAGCCAGCCTTGGGCAGGTTTCAGGGTGCCAGTGGGAAGCCTGATGGACTGGTGGCCTTTCCCCCGTGGATTGGTCTCTGGCCCAGCCCAGTCTCTTCTCAGGGGCAGGGGGTGGAGGTTGGGGTCACCGGGCCTCTTGGCACCCCCATCTGAAGGAGCAGCACTTTTCAGCTATTAAAGGCCCCCTCAATAAAAAGCATCGCTGTCTCTTATACACATCTCCAAGCACCCAGACAAGCAATAA	$%%&&&(&%%%&()&&'%&)*'&''+&&&&))+2+'()++++--,.210222:7656143347>@FKMIHIED@B1-5823???@@?A+++**(+))(''&&&%$#$$%%%&)++-22656500+*AAFCBE5445E<>=<>>>41.,,)+43(&%%%)*9::,***+110000.***?@B1000/-,+++0>@CBFEBGABAB-,,,.43466<<332375)((%&%&&7==;==;984220--.--436555798;;98:;:97111FIJHHD,++++8?ACIIOJLIP=11113>>;34==>B@<::9=AAFGGL<999899<=BCIFEE@@;93++,+,3000422266789GFHNSLLK?>@::76:::8777-,,,*),...//088:AIJIFEEFECFEGHJFH@<:;==74111444434777:;;AA@BBABCFFIAA??AGGH3312322.++)(*-0003100121)&&%&&'&&(249766FFJIKLMKILKINLISIKMSFILSOOQJDEFFB?;;993*)0(7777+*8;9:<C@8771-+))(''()**)),566>DEFFFIGGGIE?DFHCCA??<:>>DDBC;;;;9;99551-&%&&())+,,BDBCDBHHLHGBAAA=<<:6,(((()0---&&&&%%&&&&''((++-/2247:,+*)'&&%%&%%%%%(),(.---00/1,,)))&&&('-/'&'''''(32-.../<GLQJLHFEGEEJJIGKH@@??>210/2099,'%%$$$$%')((&()&(++('&&%%$$%%%&90/../10.'&&&)'()())%%&%%%1(<BBHD?AEDD===;<@BC;;;BDCA8754''''.12238++***)++160/013953//../=>?BDA<:::;3-056895551,''('&'/20079:7610/1ABCEDC333333326568:=>>?8:;;EGFG>><<<?BIG>>??@EEB<<:;:654433898744/**7&&%$&'&&'),/078:999>@C=6667D=@BA;9;::;??><<=>>??==9<-*)))**),--,,****+-)(),/()*67>55540.('''%&&&&+,,.+++'''&%	qs:i:11	du:f:2.8702	ns:i:14351	ts:i:10	mx:i:1	ch:i:1	st:Z:2024-02-14T07:55:23.546+00:00	rn:i:176473	fn:Z:FAW96611_6bbce085_69fa17d1_3958.pod5	sm:f:-409.562	sd:f:0.0096411	sv:Z:pa	dx:i:-1	RG:Z:69fa17d18c78aff9642adc25f5aff63f55751857_dna_r10.4.1_e8.2_400bps_sup@v4.3.0
c37bf89a-f235-414f-919c-e2e2f5d81d89	4	*	0	0	*	*	0	0	ATGTTTATGTATTCATTCATGGTGTGTGTGTTGGTGGGCTGGGAGATGTGTATAAGAGACAGCGATGCTTCTTTTTTATCCAGGGGGCCTTTAACTACTGGAGGACCTGCTGCAGATGGGGGTGCCAAGCAGGCCGGTGACCCCAACCTCCACCCCCTGCCCCTGAGAAGAGACTGCGGCTGGGCCAGAGACCAATCCCGGGGAAAGGCCACCAGCACCCCATCAGGCTTCCCACTGGCACCCTGAAACCTGCCAGGCTGGGCCGCCAGCGTCGTCCACAGGCCTTGGCCAGCGGGGGCCCTCAGGGAAGCAACCCCAGCTCGCATCTGGAAGGCCGGCGGTCCCCTCGGGTGGCTTGCTGATCTCTCTGTGTCGTTCTTTGGTTACAGATACCCTCTAGGACCTCGCCATCTCCCTTAATAAGCCTGGTGCGCCCCGTCTCAGGGTCCACCACCTTGCGGATGATGCTCTGCCGGGCATCCCACTCCTCCTTGGTCGTGGGCTTCATGGCCTGGATTCGGGACTTCTGCTCATCCGTCAGGACTGGGCCATCCTCTCCTCCCCAGCTGATCGGTGCCACTGGTCCAGCCGACCGGCAGAGCCTCCACCTGCTGTGCTTCCGCCTTCTCCTTGCCCTTCTTCTTCACTCTCCTCTTCTTCTTCTTCTTCCTCCTCTTGTCCTTGTACTCCCCCCGCTTCTTCGGGCCATCACTGGAGGAAGAGGAGGAGGACGAGGAGCTGAACTGGAAGAAGAGGAGGAGAGCTGGATCTTGTTCTCCTCCGGGCCTTCTGCTTGCTTCTCTTCGGGATGTGGAGGCCGAGCAGTTCCTGAGGTGTCTTTCCTGCTCTTCTTCTTCTTTCCGACCCCCGTCCCCGGGACCGGCTGCGACTCCTCGAGCGCTTGCGGGAGCCGACGTGAGCCATGGCGCCGCGGGCTCGACCGCCCTGCGGGCCGGACAGCCCGCCCCGCGCCTCTCGAGAGGAAGCGGCGGCCGTACTCTTGCGTTTGATACCACATCTGACGGGGTAACCAACTGTCTCTTATACACATCTGACGCTGCCAACGAAGCAATACG	$$$&'&$%%&$##%%'(&%$$$$%&''&&%%$$$$%&'&('+,)+.../;=<=;>>??BF:::101/.-+)))((*+*)''&&'*+///.,-)((&$$$$%&((&$#%&((''&&&(-02DIJEHIGCAA@CCFDHFGEGSFJB?CCCCFHDEE=;99::889/.--,++,-1254/))))=>>=@?865346321**&$$$%%%%%%%%%&&%&'(..21(4655667766623CBADCEE?=:8;1,.<,,,225<A@DA@B=<3('&&&(-.57667@?@AKI;;;<CBCACDKNIGMH:65567?@?==<=@5)@;;;;D@@><<?DJLIGD---+,,++577421/,(((((*('''(;;=<9@@DAA@FDHHSHJEDDE>8/...-.../10....32//..,++..-80-5-.BBCEEGGCDCCFIHGB@==<=222:<=EA66656<:878:HHGJJKGGFBBABAEEECI?>>=444349:?><988::;;;=EIF>=>55544)(&&'''()''&&&&')*'&'')+-99;>==>44445???>?=>**+9:;:5CCCEGIOHIJGIILIO877771.+)&'''((4;BFFDDKABABISHOOMNKHIQJKCDRPMOHJHIHFCRRMDA@?=><0*((&&%&&111223--94751122.0++,35789@@@C;966500075<;;<:992,)()),110//0-**)(')('''),--2420.-+%(((('))(/000227343///1404)'(**,;>BED@BB?>8880/.,+(*'&%%$&&'')11))(((''(((:BDFDADED?.--,-.--..1/11288=ACB@;=A@FEGHFBBB640-+,-)+/0<=ADE88678?;DCCDHFGSSEH@=>=EBA71.-../0000045DJIKLOPJKJIKGQIH;::77:999:>=>CAAAA;;;<=ELLFH@DBBEE?---76@?@DBB-,,+(*)4689<=HJHIDGFHFGLFHGGFA?6331110();65633//**)))(&*105655555:5555444446<;<++++++,----.4*)*%%'&'(((''%	qs:i:12	du:f:2.8938	ns:i:14469	ts:i:10	mx:i:1	ch:i:1	st:Z:2024-02-14T07:55:26.489+00:00	rn:i:176475	fn:Z:FAW96611_6bbce085_69fa17d1_3958.pod5	sm:f:-409.562	sd:f:0.0096411	sv:Z:pa	dx:i:-1	RG:Z:69fa17d18c78aff9642adc25f5aff63f55751857_dna_r10.4.1_e8.2_400bps_sup@v4.3.0
```

Dealing with duplex relationships and putting them in read names
```python
import pysam
```

```

module load miniconda
source activate sqanti3-snakemake

align=/gpfs/projects/bsc83/Projects/pantranscriptome/fairlie/ONT_preprocessing/scripts/data/minimap/sample1_sorted.bam
gt_map=/gpfs/projects/bsc83/Projects/pantranscriptome/fairlie/ONT_preprocessing/scripts/ref/gt_map.tsv
out_align=/gpfs/projects/bsc83/Projects/pantranscriptome/fairlie/ONT_preprocessing/scripts/data/umi_dedupe/sample1.bam
out_log=/gpfs/projects/bsc83/Projects/pantranscriptome/fairlie/ONT_preprocessing/scripts/data/umi_dedupesample1.log

umi_tools dedup \
    --extract-umi-method read_id \
    --umi-separator _ \
    --method adjacency \
    --edit-distance-threshold 2 \
    --per-contig \
    --per-gene \
    --gene-transcript-map ${gt_map} \
    --stdin ${align} \
    --stdout ${out_align} \
    --log ${out_log}
```

```bash
module load samtools
samtools view -hb sample1.sam > ~/mele_lab/projects/ONT_preprocessing/scripts/data/minimap/sample1.bam
samtools calmd -u sample1.bam /gpfs/projects/bsc83/Projects/pantranscriptome/fairlie/ONT_preprocessing/scripts/ref/transcripts.fa > sample1_md_tag.sam
```
